<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.clj.crmproj.mapper.LoginMapper" >
    <resultMap id="BaseResultMap" type="org.clj.crmproj.entity.User" >
        <id column="uid" property="uid" jdbcType="CHAR" />
        <result column="attr1" property="attr1" jdbcType="VARCHAR" />
        <result column="attr2" property="attr2" jdbcType="VARCHAR" />
        <result column="attr3" property="attr3" jdbcType="VARCHAR" />
        <result column="attr4" property="attr4" jdbcType="VARCHAR" />
        <result column="attr5" property="attr5" jdbcType="VARCHAR" />
        <result column="attr6" property="attr6" jdbcType="VARCHAR" />
        <result column="attr7" property="attr7" jdbcType="VARCHAR" />
        <result column="attr8" property="attr8" jdbcType="VARCHAR" />
        <result column="attr9" property="attr9" jdbcType="VARCHAR" />
        <result column="attr10" property="attr10" jdbcType="VARCHAR" />
        <result column="attr11" property="attr11" jdbcType="VARCHAR" />
        <result column="attr12" property="attr12" jdbcType="VARCHAR" />
        <result column="attr13" property="attr13" jdbcType="VARCHAR" />
        <result column="attr14" property="attr14" jdbcType="VARCHAR" />
        <result column="attr15" property="attr15" jdbcType="VARCHAR" />
        <result column="attr16" property="attr16" jdbcType="VARCHAR" />
        <result column="attr17" property="attr17" jdbcType="VARCHAR" />
        <result column="attr18" property="attr18" jdbcType="VARCHAR" />
        <result column="attr19" property="attr19" jdbcType="VARCHAR" />
        <result column="attr20" property="attr20" jdbcType="VARCHAR" />
    </resultMap>
    <sql id="Base_Column_List" >
        uid, attr1, attr2, attr3, attr4, attr5, attr6, attr7, attr8, attr9, attr10, attr11,
    attr12, attr13, attr14, attr15, attr16, attr17, attr18, attr19, attr20
  </sql>
    <select id="login" resultType="java.util.HashMap" parameterType="java.util.Map" >
        select user.uid, user.attr1, user.attr2, user.attr3, school.sid as schoolId,
        school.attr1 as schoolName, dept.sid as deptId, dept.attr1 as deptName, role.sid as roleId, role.attr1 as roleName
        from user
        left JOIN school ON school.sid = user.attr5
        left JOIN dept ON dept.sid = user.attr7
        left JOIN role ON role.sid = user.attr9
        where user.attr4 = '1' and user.attr1 = #{user,jdbcType=VARCHAR} and user.attr2 = #{pwd,jdbcType=VARCHAR}
    </select>
    <select id="getMenu" resultType="java.util.HashMap" parameterType="java.util.Map" >
        select perm.attr1 as name, perm.attr2 as ename, perm.attr3 as url from perm
        INNER JOIN user_perm on perm.sid = user_perm.permid and user_perm.userid = #{user,jdbcType=VARCHAR} and user_perm.attr4 = 1
        where perm.attr20 = 1 and perm.attr19 = #{menuid,jdbcType=VARCHAR}
    </select>
</mapper>